<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style lang="scss">
        $white: #fdfdfd;
$black: #303030;
$dark-grey: #6f6f6f;
$light-grey: #e8e8e8;

body {
  margin: 0;
  background-color: $white;
  font-family: Montserrat, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto,
    Open Sans, Ubuntu, Fira Sans, Helvetica Neue, sans-serif;
  color: $black;
  -webkit-font-smoothing: antialiased;
}

p {
  margin-top: 0;
}

button {
  font-family: inherit;
}

.screen-reader-text {
  border: 0;
  clip: rect(1px, 1px, 1px, 1px);
  clip-path: inset(50%);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute !important;
  width: 1px;
  word-wrap: normal !important;
}

.sprites {
  display: none;
}

.icon {
  display: inline-block;
  width: 1em;
  height: 1em;
  fill: currentColor;
}

.site__header {
  background-color: $black;
  padding: 1rem;
  color: $white;
  box-shadow: 0 -5px 10px 0 rgba(42, 45, 66, 0.5);

  form {
    display: flex;
    align-items: center;
    justify-content: center;
  }

  input[type="search"] {
    position: relative;
    z-index: 1;
    border-radius: 5px 0 0 5px;
    border: 2px solid $light-grey;
    padding: 0.45rem 0.5rem;
    color: $dark-grey;
  }

  label {
    width: auto;
    margin-right: 1rem;
  }

  button {
    padding: 0.45rem 0.75rem;
    border-color: #e8e8e8;
    border-radius: 0 5px 5px 0;
    background-color: $light-grey;
  }
}

.results-wrapper ul {
  position: absolute;
  width: 315px;
  max-width: 100%;
  margin: 0;
  margin-top: 0.3rem;
  padding: 0;
  border-radius: 5px;
  box-shadow: 1px 1px 10px 0px rgba($black, .5);
  background-color: $white;
  font-size: 0.9rem;
  color: $black;
  list-style: none;
  overflow: hidden;

  li {
    padding: 0.5rem 0.5rem;
    text-overflow: ellipsis;
    overflow: hidden;
    white-space: nowrap;
    
    &:not(:last-child) {
      border-bottom: 1px solid $light-grey;
    }

    &:hover {
      background-color: $light-grey;
    }
  }
}

.site__header-wrapper {
  max-width: 800px;
  margin: 0 auto;
  width: 100%;
}

.page--wrap {
  width: 100%;
  max-width: 850px;
  margin: 0 auto;
  padding: 2rem;
}

.podcast__header {
  margin-bottom: 1rem;
  background-image: linear-gradient(-147deg, #de8d94 0%, #808fae 100%);

  .icon {
    font-size: 0.8rem;
    margin-right: 0.25rem;
  }
}

.podcast__header-inner {
  display: grid;
  grid-template-columns: minmax(0, 300px) auto;
  grid-column-gap: 20px;
  grid-template-areas:
    "podcast-image podcast-title"
    "podcast-image podcast-meta";
  width: 100%;
  max-width: 895px;
  padding: 2rem;
  margin: 0 auto;
  color: $white;
}

.svg {
  display: block;
  color: $white;
}

.podcast__title {
  grid-area: podcast-title;
  margin: 0;
  margin-bottom: 1rem;
  font-size: 2rem;
}

.podcast__cover-image {
  grid-area: podcast-image;
  max-width: 100%;
  border-radius: 5px;
  box-shadow: 0 5px 20px 0px rgba(50, 70, 107, 0.5);
}

.podcast__meta {
  grid-area: podcast-meta;
  margin: 0;
  padding: 0;
  list-style-type: none;

  li {
    margin-bottom: 0.5rem;
  }
}

.podcast__episodes {
  list-style-type: none;
  max-width: 770px;
  margin: 0 auto;
  padding: 0 1rem;
}

.podcast-episode {
  display: grid;
  grid-template-columns: 150px auto;
  grid-gap: 20px;
  margin-bottom: 2rem;
  padding-bottom: 1rem;
  border-bottom: 1px solid $light-grey;
}

.podcast-episode__title {
  margin: 0;
  margin-bottom: 1rem;
  border-bottom: 1px solid #fff;
}

.podcast-episode__date {
  margin-bottom: 0.5rem;
  font-size: 0.75rem;
  font-weight: bold;
  letter-spacing: 1px;
  text-transform: uppercase;
  color: $dark-grey;
}

.podcast-episode__cover-image {
  max-width: 100%;
  border-radius: 5px;
}

.podcast-episode__button {
  width: 100%;
  padding: 0.25rem;
  border: 3px solid $black;
  border-radius: 5px;
  background-color: transparent;
  text-transform: uppercase;
  font-weight: bold;
  font-size: 14px;
  color: $black;
}

.player-wrapper {
  position: fixed;
  display: flex;
  bottom: 0;
  left: 0;
  width: 100%;
  z-index: 1;
  padding: 0.25rem;
  align-content: center;
  align-items: center;
  background-color: white;
  box-shadow: 0 0 10px 0 rgba(42, 45, 66, 0.5);
}

.player-wrapper__inner {
  width: 100%;
  max-width: 850px;
  margin: 0 auto;
  font-size: 0.75rem;
  background: $white;
}

.player {
  display: grid;
  grid-template-columns: 50px 200px auto 135px;
  grid-column-gap: 1.5rem;
  align-items: center;
}

.player__image {
  width: 50px;
  height: 50px;
  border-radius: 5px;
}

.player__buttons {
  display: flex;
  flex-wrap: wrap;

  display: grid;
  grid-template-columns: 2fr 1fr 2fr;

  flex-basis: 33%;
}

.player__button {
  background-color: transparent;
  border: 0;
  font-size: 0.75rem;
}

.player__slider {
  grid-row: 2;
  grid-column: 1 / span 3;
  flex-basis: 100%;
}

.player__title {
  white-space: nowrap;
  overflow: hidden;
}

.progress {
  flex: 10;
  position: relative;
  display: flex;
  flex-basis: 100%;
  height: 5px;
  // transition: height 0.3s;
  background: rgba(0, 0, 0, 0.5);
  cursor: ew-resize;
  border-radius: 5px;
}

.progress__filled {
  width: 50%;
  background: #191f4c;
  flex: 0;
  flex-basis: 50%;
  border-radius: 5px 0 0 5px;
}

.current-time {
  flex-basis: 33%;
}

.duration {
  order: 3;
  float: right;
  flex-basis: 33%;
  text-align: right;
}

.progress__bar--volume {
  display: flex;
  align-items: center;
  font-size: 1rem;

  // Align to top w/the other progress bar
  top: -8px;
  position: relative;

  > * {
    margin: 0 0.25rem;
  }
}

.progress__bar--duration {
  display: flex;
  flex-wrap: wrap;
}

.progress__bar--duration .progress {
  flex-basis: 100%;
}

    </style>
</head>
<body>
    <div id="app">
  
        <div class="site__header">
          <div class="site__header-wrapper">
            <form action="">
              <label for="podcast-search">Search for a podcast</label>
              <div class="results-wrapper">
                <input type="search" name="podcast-search" ref="searchBar" v-on:input="search" v-on:blur="resetSearch">
                
                <ul v-if="searchResults">
                  <li v-for="(result, index) in searchResults" v-on:click="loadPodcast(result.feedUrl)">
                    {{ result.trackName }}
                  </li>
                </ul>
              </div>
              <button type="submit">
                <span class="screen-reader-text">Search</span>
                <svg class="icon icon-search">
                    <use xlink:href="#search"></use>
                  </svg> 
              </button>
            </form>
          </div>
        </div>
      
        <div class="podcast__header">
          <div class="podcast__header-inner">
            <h1 class="podcast__title">{{ title }}</h1>
            <img class="podcast__cover-image" :src="coverImage" alt="">
      
            <div>
              <p>{{ summary }}</p>
              <ul class="podcast__meta">
                <li>
                  <svg class="icon icon-clock">
                    <use xlink:href="#clock"></use>
                  </svg> Last updated {{ lastUpdated }}
                </li>
                <li><svg class="icon icon-link">
                    <use xlink:href="#link"></use>
                  </svg> <a :href="link">{{ link }}</a>
                  </li>
                <li>
                  <svg class="icon icon-headphones">
                    <use xlink:href="#headphones"></use>
                  </svg> {{ episodes.length }} episodes
                </li>
              </ul>
            </div>
          </div>
      
          <svg class="svg" viewBox="0 0 1439 80" xmlns="http://www.w3.org/2000/svg">
              <g fill="currentColor">
                  <path d="M-1,80 L1439,80 L1439,75.0577158 C1379.79277,41.1506119 1270.6261,17.4276478 1111.5,3.88882329 C874.5,-16.2756963 723.714904,48.2131338 344,54.8931963 C226.309936,56.9636364 111.309936,46.4859939 -1,23.4602687 L-1,80 Z" id="Path"></path>
              </g>
      </svg>
        </div>
      
        <section class="podcast__episodes">
          <article v-for="(episode, index) in episodes" class="podcast-episode">
              <div>
                <!--           <img class="podcast-episode__cover-image" :src="episode.coverImage" alt=""> -->
                <img class="podcast-episode__cover-image" :src="coverImage" alt="">
                <button class="podcast-episode__button" v-on:click="loadEpisode" :data-index="index">
                  <svg class="icon icon-play">
                    <use xlink:href="#play"></use>
                  </svg> Play
                </button>
              </div>
      
              <div>
                <div class="podcast-episode__date">
                  <span aria-hidden="true" class="screen-reader-text">Published: </span>{{ episode.pubDate }}
                  <span aria-hidden="true"> | </span>
                  <span aria-hidden="true" class="screen-reader-text">Duration: </span>{{ episode.duration }}
                </div>
                <h2 class="podcast-episode__title">{{ episode.title }}</h2>
                <p class="podcast-episode__summary" v-html="episode.description"></p>
              </div>
          </article>
        </section>
      
        <div v-if="currentlyPlaying" class="player-wrapper">
          <audio ref="playerAudio" class="player__video viewer" v-on:play="updateButton" v-on:pause="updateButton" v-on:timeupdate="handleProgress" v-on:durationchange="durationUpdate"></audio>
      
          <div class="player-wrapper__inner">
            <div class="player">
              <img class="player__image" :src="coverImage" alt="">
      
              <div class="player__title">
                <b>{{ title }}</b><br> {{ currentlyPlaying.title }}
              </div>
      
              <div class="progress__bar progress__bar--duration">
                <div class="progress" ref="progress" v-on:click="scrubAudio" v-on:mousemove="mousedown && scrubAudio($event)" v-on:mousedown="mousedown = true" v-on:mouseup="mousedown = false">
                  <div class="progress__filled" ref="progressBar"></div>
                </div>
                <span class="current-time">{{ currentTime }}</span>
                <span class="duration">{{ duration }}</span>
                <div class="player__buttons">
                  <button v-on:click="skip" data-skip="-10" class="player__button">
                     <svg class="icon icon-back">
                      <use xlink:href="#back"></use>
                    </svg>&nbsp;10s
                   </button>
      
                  <button class="player__button toggle" title="Toggle Play" v-on:click="togglePlay" ref="playerButton"></button>
      
                  <button v-on:click="skip" data-skip="25" class="player__button">
                  25s&nbsp;<svg class="icon icon-forward">
                    <use xlink:href="#forward"></use>
                  </svg>
                    </button>
      
                </div>
              </div>
      
              <div class="progress__bar progress__bar--volume">
                <svg class="icon icon-volume-low">
                    <use xlink:href="#volume-low"></use>
                  </svg>
                <div class="progress" ref="volume" v-on:click="scrubVolume" v-on:mousemove="mousedown && scrubVolume($event)" v-on:mousedown="mousedown = true" v-on:mouseup="mousedown = false">
                  <div class="progress__filled" ref="volumeBar"></div>
                </div>
                <svg class="icon icon-volume-high">
                    <use xlink:href="#volume-high"></use>
                  </svg>
              </div>
      
              <!--             <input type="range" name="volume" class="player__slider" min="0" max="1" step="0.05" value=".5" v-on:change="handleVolumeUpdate" v-on:mousemove="handleVolumeUpdate"> -->
      
            </div>
          </div>
      
        </div>
      </div>
      
      <svg class="sprites">
           <symbol id="search" viewBox="0 0 8 8"><path d="M3.5 0c-1.93 0-3.5 1.57-3.5 3.5s1.57 3.5 3.5 3.5c.59 0 1.17-.14 1.66-.41a1 1 0 0 0 .13.13l1 1a1.02 1.02 0 1 0 1.44-1.44l-1-1a1 1 0 0 0-.16-.13c.27-.49.44-1.06.44-1.66 0-1.93-1.57-3.5-3.5-3.5zm0 1c1.39 0 2.5 1.11 2.5 2.5 0 .66-.24 1.27-.66 1.72-.01.01-.02.02-.03.03a1 1 0 0 0-.13.13c-.44.4-1.04.63-1.69.63-1.39 0-2.5-1.11-2.5-2.5s1.11-2.5 2.5-2.5z"/></symbol>
      
            <symbol id="headphones" viewBox="0 0 8 8">
        <path d="M4 0c-1.65 0-3 1.35-3 3v1h-.5a.5.5 0 0 0-.5.5v2a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-3.5c0-1.11.89-2 2-2 1.11 0 2 .89 2 2v3.5a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 0-.5-.5h-.5v-1c0-1.65-1.35-3-3-3z" />
      </symbol>
            
            <symbol id="link" viewBox="0 0 8 8">
              <path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"
              />
            </symbol>
            
      <symbol id="clock" viewBox="0 0 8 8">
        <path d="M4 0c-2.2 0-4 1.8-4 4s1.8 4 4 4 4-1.8 4-4-1.8-4-4-4zm0 1c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm-.5 1v2.22l.16.13.5.5.34.38.72-.72-.38-.34-.34-.34v-1.81h-1z" />
      </symbol>
      
              <symbol id="volume-low" viewBox="0 0 8 8">
                <path d="M3.34 0l-1.34 2h-2v4h2l1.34 2h.66v-8h-.66zm1.66 3v2c.09 0 .18-.01.25-.03.43-.11.75-.51.75-.97 0-.46-.31-.86-.75-.97-.08-.02-.17-.03-.25-.03z" transform="translate(1)" />
              </symbol>
      
              <symbol id="volume-high" viewBox="0 0 8 8">
                <path d="M3.34 0l-1.34 2h-2v4h2l1.34 2h.66v-8h-.66zm1.66 1v1c.17 0 .34.02.5.06.86.22 1.5 1 1.5 1.94s-.63 1.72-1.5 1.94c-.16.04-.33.06-.5.06v1c.25 0 .48-.04.72-.09h.03c1.3-.33 2.25-1.51 2.25-2.91 0-1.4-.95-2.58-2.25-2.91-.23-.06-.49-.09-.75-.09zm0 2v2c.09 0 .18-.01.25-.03.43-.11.75-.51.75-.97 0-.46-.31-.86-.75-.97-.08-.02-.17-.03-.25-.03z"
                />
              </symbol>
      
      <symbol id="play" viewBox="0 0 8 8">
        <path d="M0 0v6l6-3-6-3z" transform="translate(1 1)" />
      </symbol>
      
      <symbol  id="pause" viewBox="0 0 8 8">
        <path d="M0 0v6h2v-6h-2zm4 0v6h2v-6h-2z" transform="translate(1 1)" />
      </symbol>
            
              <symbol id="back" viewBox="0 0 8 8">
        <path d="M4 0l-4 4 4 4 1.5-1.5-2.5-2.5 2.5-2.5-1.5-1.5z" transform="translate(1)" />
      </symbol>
            
              <symbol id="forward" viewBox="0 0 8 8">
        <path d="M1.5 0l-1.5 1.5 2.5 2.5-2.5 2.5 1.5 1.5 4-4-4-4z" transform="translate(1)" />
      </symbol>
      </svg>
</body>
<script>
    const getElement = (parent, tagName) =>
  parent.getElementsByTagName(tagName)[0].textContent;

const getElements = (parent, tagName) => parent.getElementsByTagName(tagName);

var app = new Vue({
  el: "#app",
  data: {
    mousedown: false,
    title: "",
    lastUpdated: "",
    link: "",
    summary: "",
    coverImage: "",
    episodes: [],
    currentlyPlaying: null,
    currentTime: "0:00:00",
    duration: "0:00:00",
    icons: {
      play: '<svg class="icon icon-play"><use xlink:href="#play"></use></svg>',
      pause:
        '<svg class="icon icon-pause"><use xlink:href="#pause"></use></svg>'
    },
    typeAhead: null,
    searchResults: [],
    currentSearch: false
  },
  methods: {
    loadPodcast: function(feedUrl) {
      this.resetSearch();
      
      fetch(new Request(`https://cors-anywhere.herokuapp.com/${feedUrl}`)).then(
        results => {
          // results returns XML. lets cast this to a string, then create
          // a new DOM object out of it!
          results.text().then(str => {
            let responseDoc = new DOMParser().parseFromString(
              str,
              "application/xml"
            );

            this.title = getElement(responseDoc, "title");
            this.lastUpdated = getElement(responseDoc, "pubDate");
            this.link = getElement(responseDoc, "link");
            this.summary = getElement(responseDoc, "itunes:summary");
            this.coverImage = responseDoc
              .getElementsByTagName("itunes:image")[0]
              .getAttribute("href");
            this.episodes = [];
            Array.from(getElements(responseDoc, "item")).forEach(item => {
              this.episodes.push({
                title: getElement(item, "title"),
                pubDate: getElement(item, "pubDate"),
                description: getElement(item, "description"),
                duration: getElement(item, "itunes:duration"),
                audio: item
                  .getElementsByTagName("enclosure")[0]
                  .getAttribute("url")
              });
            });
            
            const lastUpdated = Date.parse(this.lastUpdated);
            this.lastUpdated = `${lastUpdated}`;

            console.log(this.episodes);
          });
        }
      );
    },
    loadEpisode: function(event) {
      const player = this.$refs.playerAudio;
      const episode = this.episodes[event.target.dataset.index];
      const button = this.$refs.playerButton;

      this.currentlyPlaying = episode;
      player.setAttribute("src", episode.audio);
      this.togglePlay();
      player.play();
    },
    resetSearch: function(e) {
      // e.currentTarget.value = '';
      // this.searchResults = [];
    },
    togglePlay: function() {
      const player = this.$refs.playerAudio;
      const method = player.paused ? "play" : "pause";
      
      player[method]();
      this.updateButton();
    },
    updateButton: function() {
      const player = this.$refs.playerAudio;
      const button = this.$refs.playerButton;
      const icon = player.paused ? this.icons.play : this.icons.pause;
      
      button.innerHTML = icon;
    },
    handleProgress: function() {
      const player = this.$refs.playerAudio;
      const progressBar = this.$refs.progressBar;
      const percent = player.currentTime / player.duration * 100;

      this.currentTime = this.formatTime(player.currentTime);
      progressBar.style.flexBasis = `${percent}%`;
    },
    durationUpdate: function(e) {
      this.duration = this.formatTime(e.currentTarget.duration);
    },
    formatTime: function(timeInSeconds) {
      const hours = Math.floor((timeInSeconds / 3600) % 60);
      let minutes = Math.floor((timeInSeconds / 60) % 60);
      let seconds = Math.floor(timeInSeconds % 60);
      
      minutes = minutes.toString().length === 1 ? `0${minutes}` : minutes;
      seconds = seconds.toString().length === 1 ? `0${seconds}` : seconds;
      
      return `${hours}:${minutes}:${seconds}`;
    },
    handleVolumeUpdate: function(e) {
      const player = this.$refs.playerAudio;
      player.volume = e.currentTarget.value;
    },
    scrubAudio: function(e) {
      const player = this.$refs.playerAudio;
      const progressBar = this.$refs.progressBar;
      const progress = this.$refs.progress;
      const scrubTime = e.offsetX / progress.offsetWidth * player.duration;

      player.currentTime = scrubTime;
    },
    scrubVolume: function(e) {
      const player = this.$refs.playerAudio;
      const volumeBar = this.$refs.volumeBar;
      const volume = this.$refs.volume;
      const scrubTime = e.offsetX / volume.offsetWidth * 10000;

      volumeBar.style.flexBasis = `${scrubTime / 100}%`;
      player.volume = scrubTime / 10000;
    },
    skip: function(e) {
      const player = this.$refs.playerAudio;
      player.currentTime += parseFloat(e.currentTarget.dataset.skip);
    },
    search: function(e) {
      const _that = this;
      const chars = e.currentTarget.value.length;
      console.log(chars);
      this.searchResults = [];

      // Search if we have more than 3 chars.
      if (chars < 3) {
        return;
      }

      if (this.currentSearch) {
        this.currentSearch.abort();
      }

      this.currentSearch = _that.getJSON(
        `https://itunes.apple.com/search?media=podcast&attribute=titleTerm&limit=15&term=${
          e.currentTarget.value
        }`,
        function(response) {
          for (var i = 0; i < response.results.length; i++) {
            _that.searchResults.push({
              trackName: response.results[i].trackName,
              feedUrl: response.results[i].feedUrl
            });
          }

          _that.currentSearch = false;
        }
      );
    },
    // Adapted from: http://youmightnotneedjquery.com/
    getJSON: function(url, callback) {
      const request = new XMLHttpRequest();
      request.open('GET', url, true);

      request.onload = function() {
        if (this.status >= 200 && this.status < 400) {
          callback(JSON.parse(this.response));
        } else {
          // We reached our target server, but it returned an error
         console.error(this.statusText);
        }
      };

      request.onerror = function() {
        // There was a connection error of some sort
        console.error(this.statusText);
      };

      request.send();
    },
  },
  created: function() {
    this.loadPodcast(`https://mbmbam.libsyn.com/rss`);
  }
});

</script>
</html>